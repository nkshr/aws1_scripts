#!/bin/sh

log=n
logtime=0

if [ $# -lt 1 ]; then
      echo "Usage: aws1_stereo.aws [log<number>]"
fi

lcc=n
tlcc=n
alg=quad
go=y

for arg in $*
do
    case $arg in
	"lcc") lcc=y;;
	"tlcc") tlcc=y;;
	"full") alg=full;;
	"mm") alg=mm;;
	"rad") alg=rad;;
	"quad") alg=quad;;
	"go") go=y;;
    esac
done

source ./$1
echo "Replay from $logtime of $logpath"

channel imgr img1 
channel imgr img2

filter glstvw view -i -o

channel imgr img1c
channel imgr img2c

filter lcc lcc1 -i -o
fset lcc1 ch_in img1 ch_out img1c
fset lcc1 flipx yes flipy yes
fset lcc1 update $tlcc
fset lcc1 alg $alg
fset lcc1 alpha 0.0001 range 3 sigma 3 bias 1.0
fset lcc1 qs 0.000001 qb 0.0001 
fset lcc1 fmap c:/cygwin/home/yhmtmt/aws/campar/lcc1.yml
fset lcc1 fcp c:/cygwin/home/yhmtmt/aws/campar/cpl.yml

filter lcc lcc2 -i -o
fset lcc2 ch_in img2 ch_out img2c
fset lcc2 flipx yes flipy yes
fset lcc2 update $tlcc
fset lcc2 alg $alg
fset lcc2 alpha 0.0001 range 3 sigma 3 bias 1.0
fset lcc2 qs 0.000001 qb 0.0001 
fset lcc2 fmap c:/cygwin/home/yhmtmt/aws/campar/lcc2.yml
fset lcc2 fcp c:/cygwin/home/yhmtmt/aws/campar/cpr.yml

if [ $lcc = n ]; then
    fset lcc1 pass y
    fset lcc2 pass y
fi

channel imgr img2cm
channel imgr img1cm

filter bkgmsk bm1 -i -o
fset bm1 ch_in img1c
fset bm1 ch_out img1cm
fset bm1 alpha 0.0001 mth 10 bkgth 0.001
fset bm1 fmask c:/cygwin/home/yhmtmt/aws/campar/mask1
fset bm1 update yes

filter bkgmsk bm2 -i -o
fset bm2 ch_in img2c
fset bm2 ch_out img2cm
fset bm2 alpha 0.01 mth 10 bkgth 0.1
fset bm2 fmask c:/cygwin/home/yhmtmt/aws/campar/mask2
fset bm2 update yes

fset view caml img1cm camr img2cm
fset view flipx no flipy no
fset view width 1920 height 1080
fset view udl yes udr yes
fset view fchsbd c:/cygwin/home/yhmtmt/aws/models/chsbd_6_9_0.02605.yml
fset view fcpl c:/cygwin/home/yhmtmt/aws/campar/cpl.yml
fset view fcpr c:/cygwin/home/yhmtmt/aws/campar/cpr.yml
fset view fstp c:/cygwin/home/yhmtmt/aws/campar/stcp.yml
fset view fchsbdl c:/cygwin/home/yhmtmt/aws/chsbd/chsbdl.yml
fset view fchsbdr c:/cygwin/home/yhmtmt/aws/chsbd/chsbdr.yml
fset view fchsbdc c:/cygwin/home/yhmtmt/aws/chsbd/chsbdc.yml
fset view fcapture c:/cygwin/home/yhmtmt/aws/campar/
filter read_ch_log log -i -o img1 img2
fset log path $logpath
online no

go $logtime
if [ go = n ]; then
    pause
fi
